<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toko Kang Ruli</title>
    <style>
        :root { --primary: #ee4d2d; --bg: #f8f9fa; --text: #333; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; }
        .app-container { max-width: 480px; margin: 0 auto; background: #fff; min-height: 100vh; box-shadow: 0 0 20px rgba(0,0,0,0.05); }
        
        /* Header */
        header { background: linear-gradient(135deg, var(--primary), #ff7e5f); color: white; padding: 30px 20px; text-align: center; border-radius: 0 0 25px 25px; }
        .profile-pic { width: 90px; height: 90px; background: #fff; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; border: 4px solid rgba(255,255,255,0.3); font-size: 40px; overflow: hidden;}
        h1 { margin: 5px 0; font-size: 1.4rem; }
        p.tagline { font-size: 0.9rem; opacity: 0.9; }

        /* Search */
        .search-box { padding: 20px; position: sticky; top: 0; background: #fff; z-index: 10; border-bottom: 1px solid #eee; }
        input[type="text"] { width: 100%; padding: 12px 15px; border: 2px solid #eee; border-radius: 50px; outline: none; box-sizing: border-box; }
        input[type="text"]:focus { border-color: var(--primary); }

        /* List */
        .product-list { padding: 10px 15px; }
        .loading { text-align: center; padding: 20px; color: #888; }
        .product-card { display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px; margin-bottom: 12px; border-radius: 12px; text-decoration: none; color: inherit; border: 1px solid #eee; transition: 0.2s; }
        .product-card:hover { transform: translateY(-2px); border-color: var(--primary); }
        .title { font-weight: 600; font-size: 0.95rem; margin-bottom: 5px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .price { color: var(--primary); font-weight: 700; font-size: 1.1rem; }
        .stats { font-size: 0.75rem; color: #888; margin-top: 4px; }
        .badge { background: #fff0e8; color: var(--primary); padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; }
        .btn-check { background: var(--primary); color: white; padding: 10px 15px; border-radius: 8px; font-weight: 600; font-size: 0.9rem; white-space: nowrap; }
        
        footer { text-align: center; padding: 30px; font-size: 0.8rem; color: #888; }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <div class="profile-pic">
            <img src="https://via.placeholder.com/150/ee4d2d/FFFFFF?text=KR" style="width:100%; height:100%; object-fit:cover;">
        </div>
        <h1>Toko Kang Ruli</h1>
        <p class="tagline">"Pilihan Jujur, Harga Akur."</p>
    </header>

    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Cari barang..." onkeyup="filterProducts()">
    </div>

    <div class="product-list" id="productList">
        <div class="loading">Memuat data dari Google Sheet...</div>
    </div>

    <footer>&copy; 2025 Toko Kang Ruli.</footer>
</div>

<script>
    // --- PENTING: GANTI LINK DI BAWAH INI ---
    // Masukkan Link CSV dari langkah "Publish to Web" di sini:
    const googleSheetURL = "https://docs.google.com/spreadsheets/d/1pAKjzozBh7PsOnWqa_hjRcjABFSDbop7pf7MIzYZKEs/edit?usp=sharing";
    // ----------------------------------------

    let products = [];
    const listContainer = document.getElementById('productList');

    // Fungsi mengambil data dari Sheet
    fetch(googleSheetURL)
    .then(response => response.text())
    .then(csvText => {
        products = parseCSV(csvText);
        renderProducts(products);
    })
    .catch(error => {
        listContainer.innerHTML = '<div class="loading">Gagal memuat data. Pastikan Link CSV benar.</div>';
        console.error('Error:', error);
    });

    // Fungsi Render Produk
    function renderProducts(data) {
        listContainer.innerHTML = '';
        if(data.length === 0) {
            listContainer.innerHTML = '<div class="loading">Tidak ada produk ditemukan.</div>';
            return;
        }
        
        data.forEach(item => {
            // Lewati baris kosong atau header
            if(!item.name || item.name === "Nama Produk") return; 

            const card = document.createElement('a');
            card.className = 'product-card';
            card.href = item.link;
            card.target = "_blank";
            
            card.innerHTML = `
                <div class="info">
                    <div class="title">${item.name}</div>
                    <div class="price">${item.price}</div>
                    <div class="stats">
                        <span class="badge">ðŸ”¥ ${item.sold} Terjual</span>
                    </div>
                </div>
                <div class="btn-check">Beli ></div>
            `;
            listContainer.appendChild(card);
        });
    }

    // Fungsi Search
    function filterProducts() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        const filtered = products.filter(p => p.name && p.name.toLowerCase().includes(term));
        renderProducts(filtered);
    }

    // Fungsi Parse CSV Sederhana
    function parseCSV(text) {
        const lines = text.split('\n');
        return lines.map(line => {
            // Regex untuk menangani koma di dalam tanda kutip (cth: "109,8RB")
            const parts = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
            if (!parts || parts.length < 4) return {};
            
            // Bersihkan tanda kutip
            const clean = (str) => str ? str.replace(/^"|"$/g, '').trim() : '';

            // Mapping Kolom: 0=Nama, 1=Harga, 2=Terjual, 3=Link
            return {
                name: clean(parts[0]),
                price: clean(parts[1]),
                sold: clean(parts[2]),
                link: clean(parts[3])
            };
        });
    }
</script>

</body>
</html>
